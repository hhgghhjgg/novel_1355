// logout.php

<?php
/*
=====================================================
    NovelWorld - Logout Script
    Version: 2.0 (Serverless Ready - JWT/Cookie Based)
=====================================================
    - این اسکریپت وظیفه خروج کاربر از سیستم را بر عهده دارد.
    - در سیستم مبتنی بر توکن، "خروج" به معنای حذف توکن از سمت کلاینت (مرورگر) است.
    - ما این کار را با بازنویسی کوکی 'auth_token' و تنظیم تاریخ انقضای آن در گذشته انجام می‌دهیم.
      این کار به مرورگر دستور می‌دهد که کوکی را فوراً حذف کند.
*/

// --- گام ۱: بررسی می‌کنیم که کوکی اصلاً وجود دارد یا نه ---
// این کار جلوی اجرای غیرضروری کد را می‌گیرد.
if (isset($_COOKIE['auth_token'])) {
    
    // --- گام ۲: حذف کوکی ---
    // برای حذف یک کوکی، باید آن را با همان پارامترهایی که با آن تنظیم شده،
    // بازنویسی کنیم، اما تاریخ انقضای آن را در گذشته قرار دهیم.
    unset($_COOKIE['auth_token']);
    
    setcookie('auth_token', '', [
        'expires' => time() - 3600, // یک ساعت در گذشته
        'path' => '/',
        'domain' => '',
        'secure' => true,
        'httponly' => true,
        'samesite' => 'Strict'
    ]);
}

// --- گام ۳: هدایت کاربر به صفحه اصلی ---
// پس از خروج موفقیت‌آمیز، کاربر را به صفحه اصلی سایت هدایت می‌کنیم.
header("Location: index.php");

// --- گام ۴: پایان اجرای اسکریپت ---
// فراخوانی exit() پس از header("Location: ...") یک رویه خوب امنیتی است
// تا اطمینان حاصل شود هیچ کد دیگری پس از هدایت اجرا نمی‌شود.
exit();
?>
